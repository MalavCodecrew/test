<div id="spin-to-win" class="spin-popup">
  <div class="wheel-container">
    <div class="wheel-pin"></div>
    <canvas id="wheel-canvas" width="500" height="500"></canvas>
    <button id="spin-button" class="spin-button">Spin</button>
  </div>
  <button id="close-button" class="close-button">Close</button>
  <div id="prize-result" class="prize-result"></div>
</div>

// Prizes Array
const prizes = [
  "10% Off",
  "20% Off",
  "Free Shipping",
  "No Prize",
  "15% Off",
  "Buy 1 Get 1 Free",
  "25% Off",
  "50% Off",
];

let spinning = false;

// Function to Draw the Wheel
function drawWheel() {
  const canvas = document.getElementById("wheel-canvas");
  const ctx = canvas.getContext("2d");
  const segments = prizes.length;
  const arc = (2 * Math.PI) / segments;

  prizes.forEach((prize, i) => {
    const startAngle = i * arc;
    const endAngle = startAngle + arc;

    ctx.beginPath();
    ctx.moveTo(250, 250);
    ctx.arc(250, 250, 250, startAngle, endAngle);
    ctx.fillStyle = i % 2 === 0 ? "#f4c542" : "#ff6f61";
    ctx.fill();

    ctx.save();
    ctx.translate(
      250 + Math.cos(startAngle + arc / 2) * 180,
      250 + Math.sin(startAngle + arc / 2) * 180
    );
    ctx.rotate(startAngle + arc / 2);
    ctx.fillStyle = "#fff";
    ctx.font = "16px Arial";
    ctx.textAlign = "center";
    ctx.fillText(prize, 0, 0);
    ctx.restore();
  });
}

// Spin the Wheel
function spinWheel() {
  if (spinning) return;
  spinning = true;

  const canvas = document.getElementById("wheel-canvas");
  const ctx = canvas.getContext("2d");
  const segments = prizes.length;
  const arc = (2 * Math.PI) / segments;

  let currentAngle = 0;
  let spinAngle = Math.random() * 360 + 360 * 5; // Random stop angle + multiple spins
  let spinSpeed = 20; // Initial speed

  const spinInterval = setInterval(() => {
    spinSpeed *= 0.98; // Gradually reduce speed
    currentAngle += spinSpeed;

    ctx.clearRect(0, 0, 500, 500);
    ctx.save();
    ctx.translate(250, 250);
    ctx.rotate((currentAngle * Math.PI) / 180);
    ctx.translate(-250, -250);
    drawWheel();
    ctx.restore();

    if (spinSpeed < 0.5) {
      clearInterval(spinInterval);
      const finalAngle = (360 - (currentAngle % 360)) * (Math.PI / 180);
      const index = Math.floor(
        (segments - Math.floor((finalAngle / (2 * Math.PI)) * segments)) %
          segments
      );
      document.getElementById("prize-result").textContent = `You won: ${prizes[index]}!`;
      spinning = false;
    }
  }, 30);
}

// Event Listeners
document.getElementById("spin-button").addEventListener("click", spinWheel);

document.getElementById("close-button").addEventListener("click", () => {
  document.getElementById("spin-to-win").classList.remove("active");
});

// Display the Popup after 3 Seconds
setTimeout(() => {
  document.getElementById("spin-to-win").classList.add("active");
}, 3000);

// Initialize Wheel
drawWheel();



{% schema %}
  {
    "name": "Spin to Win",
    "settings": [],
    
  "presets": [
    {
      "name": "Spin to Win"
    }
  ]
  }
{% endschema %}